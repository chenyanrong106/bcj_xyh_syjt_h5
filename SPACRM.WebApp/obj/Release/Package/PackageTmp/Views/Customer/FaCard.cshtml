@{
    ViewBag.Title = "会员发卡";
    Layout = "~/Views/Shared/_LayoutB.cshtml";
}
@section htmlhead{
    @Html.Css("plugin/validator")
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .col-sm-8 {
            padding: 0;
        }
    </style>

    <script language="javascript" type="text/javascript">
        function FormCheck() {
            //alert("1211");
            var BZ = true;
            var st;
            var lSnr;
            st = rd.dc_init(100, 115200);
            if (st <= 0 && BZ) {
                alert("读卡机连接不成功!");
                BZ = false;
            }

            st = rd.dc_card(0, lSnr);
            if (st != 0 && BZ) {
                alert("没有检测非接触式IC卡!");
                rd.dc_exit();
                BZ = false;
            }
            document.myform.CUST_NO.value = rd.get_bstrRBuffer_asc;

            st = rd.dc_beep(50);
            if (st != 0 && BZ) //返回值小于0表示失败
            {
                alert("读卡机连接不成功!");
                rd.dc_exit();
                BZ = false;
            }

            //关闭端口
            st = rd.dc_exit();
            if (st != 0 && BZ) //返回值小于0表示失败
            {
                alert("读卡机端口关闭不成功!");
                BZ = false;
            }

            if (isAllSpace(document.myform.CUST_NO.value) && BZ) {
                alert("请读卡或输入会员编号！");
                document.myform.CUST_NO.focus();
                BZ = false;
            }
            if (BZ == true) {
                alert("读卡成功！");
            }
            return BZ;
        }

       
    </script>
}

<object id="rd" codebase="/comRD800.dll" classid="clsid:638B238E-EB84-4933-B3C8-854B86140668" width="0" height="0"></object>
<div style="margin: -2px 15px;">
    <div id="h_title" class="h_title">会员发卡</div>
    <div>
        <form id="frmFaCardSave" action="@Url.Action("FaCardSave")" method="post" role="form" name="myform">
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="ORG_NAME">顾客姓名：</label>
                    <div class="col-xs-7">
                        <span id="spanCUST_NAME">@Request.QueryString["name"]</span>
                        <input type="hidden" id="CUST_ID" name="ID" value="@Request.QueryString["cid"]" />
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="ORG_NAME">手机号码：</label>
                    <div class="col-xs-7">
                        <span id="spanPHONE">@Request.QueryString["phone"]</span>

                    </div>
                </div>

            </div>
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="BRAND">芯片号：</label>
                    <div class="col-xs-7">
                        @Html.TextBox("CUST_NO", null, new { @class = "form-control", maxlength = "18", style = "width:200px",@readonly="readonly" })
                        <span class="btn btn-primary" style="width: 62px" onclick="FormCheck();">读卡  </span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="BRAND">会员卡号：</label>
                    <div class="col-xs-7">
                        @Html.TextBox("CARD_NO", null, new { @class = "form-control", maxlength = "18", style = "width:210px" })
                       @* <span class="btn btn-primary" style="width: 62px" onclick="FormCheck();">读卡  </span>*@
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="MANAGER">密 码：</label>
                    <div class="col-xs-7">
                        @Html.TextBox("PASSWORD", null, new { @class = "form-control", type = "password", maxlength = "8" })

                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <label class="col-xs-3 control-label" for="MANAGER"></label>
                    <div class="col-xs-7">
                        <input type="checkbox" name="IS_UNREGISTER" checked="checked" /> 记名卡
                    </div>
                </div>
            </div>
            <div class="btnpanel_right">
                <button type="reset" id="btnCancel" class="btn btn-default">取 消  </button>
                <button type="button" id="btnSave" class="btn btn-primary">保 存  </button>
            </div>

        </form>



    </div>
</div>
@section jssection{
    <script type="text/javascript">
        var util = {};
        var options = {
            buyCardUrl: "@Url.Action("BuyCards", "Order")"
        };
    </script>
    @Html.Js("plugins/validator/validator", "app/customer/facard")
}
