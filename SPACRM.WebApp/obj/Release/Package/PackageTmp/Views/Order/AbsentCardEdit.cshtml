@{
    Layout = "~/Views/Shared/_LayoutB.cshtml";
}
@using SPACRM.Entity
@model SPACRM.Entity.Entities.CUST_CARD_EX


@section htmlhead{
    @Html.Css("plugin/xjgrid", "plugin/xjdailog")
    @Html.Css("plugin/validator")
}


<div style="margin: 10px 15px; background-color: #fff;">


    <div id="mainbody" class=" panel-primary">
        <div style="padding: 10px 15px;">

            <form id="formSave" action="@Url.Action("AbsentCardSave", new { id = Model.ID })" method="post" role="form"  class="form-horizontal">

                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">卡/券 名称</label>
                        <div class="col-xs-9">
                            @Html.TextBox("CARD_NAME", Model.CARD_NAME, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">卡/券 类型</label>
                        <div class="col-xs-9">
                            @{
                                string cardTypeName = "";
                                if (Model.CARD_TYPE == 1)
                                {
                                    cardTypeName = (" 储值卡 ");
                                }
                                else if (Model.CARD_TYPE == 2)
                                {
                                    cardTypeName = (" 疗程卡 ");
                                }
                                else if (Model.CARD_TYPE == 5)
                                {
                                    cardTypeName = " 项目券 ";
                                }
                                else if (Model.CARD_TYPE == 6)
                                {
                                    cardTypeName = " 现金券 ";
                                }
                            }
                            @Html.TextBox("CARD_TYPE_NAME",  cardTypeName, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </div>
                @if (Model.CUST_CDETAIL != null)
                {
                    <div class="form-group">
                        <table id="tCardLavel" class="table table-advance table-hover">
                            <thead style="background-color: #f7f8fa">
                                <tr class='thead'>
                                    <td>
                                        <div style="text-align: left;">项目</div>
                                    </td>
                                    <td>
                                        <div style="text-align: left;">价格</div>
                                    </td>
                                    <td>
                                        <div style="text-align: left;">总次数</div>
                                    </td>
                                    <td>
                                        <div style="text-align: left;">目前可用次数</div>
                                    </td>
                                    <td>
                                        <div style="text-align: left;">退减次数</div>
                                    </td>
                                </tr>
                            </thead>
                            <tbody id="tbodyCDetails">
                                @foreach (var cc in Model.CUST_CDETAIL)
                                {
                                    <tr id="tr_@cc.ID">
                                        <td>@cc.SERVICE_NAME</td>
                                        <td>@cc.SERVICE_PRICE</td>
                                        <td>@cc.SERVICE_QTY</td>
                                        <td>@cc.AVA_QTY</td>
                                        <td>
                                            <input type="text" name="RefundQty" value="@cc.AVA_QTY" max_qty="@cc.AVA_QTY" price="@cc.SERVICE_PRICE" onchange="util.onRefundQtyChanged(this, @cc.ID)"/>
                                            <input type="hidden" name="CDetailID" value="@cc.ID" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>
                }
                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">应退金额</label>
                        <div class="col-xs-9">
                            <span id="CASH_AMT" class="badge badge-info">@(Model.BALANCE.HasValue ? Model.BALANCE : 0m)</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">实退金额</label>
                        <div class="col-xs-9">
                            @Html.TextBox("Return_AMT", "", new { @class = "form-control" })
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">退款方式</label>
                        <div class="col-xs-9">
                            <select id="Return_Type" class="form-control" name="Return_Type">
                                <option value="">请选择退款方式...</option>
                                @foreach (var item in ViewBag.BackCardPayMode)
                                {
                                    <option value="@item.CODE">@item.NAME</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <label class="col-xs-2 control-label">备 注</label>
                        <div class="col-xs-9">
                            @Html.TextBox("Remark", "", new { @class = "form-control" })
                        </div>
                    </div>
                </div>

            </form>
            <div class="modal-footer" style="border: none;">
                <button type="button" id="btnSave" class="btn btn-primary">保存</button>&nbsp;&nbsp;&nbsp;
                                <button type="button" id="btnReturn" class="btn btn-default">返回</button>

            </div>
        </div>
    </div>
</div>


@section jssection{
    <script type="text/javascript">
        var util = {};
        var options = {

        };
    </script>
    @Html.Js("plugins/validator/validator", "plugins/xjdailog/xjdailog", "app/order/AbsentCardEdit")

}