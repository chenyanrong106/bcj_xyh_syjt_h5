@{
    ViewBag.Title = "会员退卡";
}
@model SPACRM.Entity.Entities.CUST_INFO_EX

@section htmlhead{
    @Html.Css("plugin/validator", "plugin/xjdailog")
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .searchpanel {
            background-color: #f7f8fa; /*border: 1px solid #ccc;*/
            padding: 5px 15px;
            margin-left: 10px;
            border-radius: 4px;
        }

            .searchpanel .form-group label {
                margin-bottom: 4px;
            }

        .panel-body {
            height: 450px;
        }
    </style>

    <style>
        #tCustInfo {
            border: 0px solid #e6e5e5;
            margin-top: 0px;
            line-height: 30px;
        }
    </style>


}
<form action="@Url.Action("AbsentCardSave")" id="formSave" method="post" role="form">
    <div class="s_container">
        <div id="page-heading">
            <h2>
                <i class="fa fa-group"></i>退卡</h2>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>会员信息</h4>
                    </div>
                    <div class="panel-body" style="height: auto;">
                        <div class="form-group col-xs-6">
                            <label class="col-sm-3 control-label" for="EMAIL">会员姓名：</label>
                            <div class="col-sm-8 input-group">
                                @Html.TextBox("NAME", @Model.NAME, new { @class = "form-control", @readonly = "readonly", placeholder = "会员姓名" })
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-3 control-label" for="EMAIL">联系电话：</label>
                            <div class="col-sm-8 input-group">
                                @Html.TextBox("MOBILE", @Model.MOBILE, new { @class = "form-control", @readonly = "readonly", placeholder = "联系电话" })
                            </div>
                        </div>
                        <div class="l-box-title">
                        </div>
                        <div class="mb10">
                        </div>

                        @*卡级信息*@
                        <table id="tCardLavel" class="table table-advance table-hover">
                            <thead style="background-color: #f7f8fa">
                                <tr class='thead'>
                                    @*<td style="width: 5%;">
                                        <div style="text-align: left;">
                                            <input type="checkbox" id="isAllSelect" onclick="util.isAllSelectOnClick(this)" />
                                        </div>
                                    </td>*@
                                    <th style="width: 15%;">
                                        <div style="text-align: left;">归属门店</div>
                                    </th>
                                    <th style="width: 8%;">
                                        <div style="text-align: left;">类型</div>
                                    </th>
                                    <th style="width: 17%;">
                                        <div style="text-align: left;">卡级</div>
                                    </th>
                                    <th style="width: 15%;">
                                        <div style="text-align: left;">面额</div>
                                    </th>
                                    <th style="width: 10%;">
                                        <div style="text-align: left;">余额</div>
                                    </th>
                                    <th style="width: 20%;">
                                        <div style="text-align: left;">欠款</div>
                                    </th>
                                    @*<th style="width: 20%;">
                                        <div style="text-align: left;">应退金额</div>
                                    </th>*@
                                    <th style="width: 10%;">
                                        <div style="text-align: left;">操作</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.CUST_CARD != null)
                                {

                                    foreach (var c in Model.CUST_CARD)
                                    {
                                    <tr class='strip'>
                                        @*<td>
                                            @if (c.CARD_TYPE == 1)
                                            {
                                                <input type="checkbox" id="isSelect" name="isSelect" value="@c.ID|@c.RRTUEN_AMT|@c.ARREARS|@c.CARD_ID"  onclick = "util.isSelectOnClick(this)"  />
                                            }
                                            else
                                            {
                                                <input type="checkbox" id="isSelect" name="isSelect" value="@c.ID|@c.BALANCE|@c.ARREARS|@c.CARD_ID"  onclick = "util.isSelectOnClick(this)"  />
                                            }
                                            <input type="hidden" name="ID" value="@c.ID" />
                                            <input type="hidden" name="STORE_ID" value="@c.STORE_ID" />
                                        </td>*@
                                        <td>@c.STORE_NAME</td>
                                        <td>
                                            @if (c.CARD_TYPE == 1)
                                            {
                                                @(" 储值卡 ")
                                            }
                                            else if (c.CARD_TYPE == 2)
                                            {
                                                @(" 疗程卡 ")
                                            }
                                            else if (c.CARD_TYPE == 5)
                                            {
                                                @(" 项目券 ")
                                            }
                                            else if (c.CARD_TYPE == 6)
                                            {
                                                @(" 现金券 ")
                                            }
                                        </td>
                                        <td>@c.CARD_NAME</td>
                                        <td>@c.PAR_AMT</td>
                                        <td>@c.BALANCE</td>
                                        <td>@c.ARREARS</td>
                                        @*<td>@(c.CARD_TYPE == 1 ? c.RRTUEN_AMT : c.BALANCE)</td>*@
                                        <td><a href="javascript:;" onclick="util.openDialog(this, @c.ID)">退卡</a></td>
                                    </tr>
                                            //疗程信息
                                            if (c.CUST_CDETAIL.Count > 0)
                                            {
                                                foreach (var cc in c.CUST_CDETAIL)
                                                {
                                    <tr class='strip'>
                                        <td></td>
                                        <td>项目：@cc.SERVICE_NAME</td>
                                        <td>价格：@cc.SERVICE_PRICE</td>
                                        <td>总次数：@cc.SERVICE_QTY</td>
                                        <td>剩余次数：@cc.AVA_QTY</td>
                                        <td>来源：@(cc.TYPE == 1 ? "购买" : "赠送")；截止：@DateTime.Parse(cc.VALID_EDATE.ToString()).ToString("yyyy-MM-dd")</td>
                                        <td></td>
                                    </tr>
                                                }
                                            }
                                    }
                                }
                                else
                                {
                                }
                            </tbody>
                        </table>

                        @*<div class="col-md-12">
                            <div class="form-group col-xs-4">
                                <label class="col-sm-4 control-label" for="EMAIL">应退金额￥：</label>
                                <div class="col-sm-8 input-group">
                                    <span id="CASH_AMT" class="badge badge-info">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group col-xs-4">
                                <label class="col-sm-4 control-label" for="EMAIL">实退金额￥：</label>
                                <div class="col-sm-8 input-group">
                                    <input type="text" id="Return_AMT" name="Return_AMT" class="form-control" />
                                </div>
                            </div>

                            <div class="form-group col-xs-4">
                                <label class="col-sm-4 control-label" for="EMAIL">退款方式：</label>
                                <div class="col-sm-8 input-group">
                                    <select id="Return_Type" class="form-control" name="Return_Type">
                                        @foreach (var item in ViewBag.BackCardPayMode)
                                        {
                                            <option value="@item.CODE">@item.NAME</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group col-xs-4">
                                <label class="col-sm-4" for="EMAIL">备注：</label>
                                <div class="col-sm-8">
                                    <input type="text" id="txtRemark" name="txtRemark" class="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                        </div>
                        <div class="form-group btnpanel_right" id="divBtnSave" style="margin-top: 5px;">
                            <button type="button" id="btnSave" class="btn btn-primary">保存</button>
                            <button type="button" id="btnReturn" class="btn btn-default">返回</button>
                        </div>*@

                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" name="HCARD_ID" id="HCARD_ID" value="@Model.CARD_ID" />
    <input type="hidden" name="ProdCardID" id="ProdCardID" value="@Model.PCID" />
    <input type="hidden" name="HCARD_AMT" id="HCARD_AMT" />
    <input type="hidden" name="Total_AMT" id="Total_AMT" />
    <input type="hidden" id="hideCUST_ID" name="CUST_ID" value="@Model.ID" />
    <input type="hidden" name="BUY_AMT" value="@Model.BALANCE" />
    <input type="hidden" id="hidePROD_NAME" name="CARD_NAME" />
    <input type="hidden" id="hideCardNo" name="CARD_NO" value="@Model.CARD_NO" />


</form>


@section jssection{
    <script type="text/javascript">
        var util = {};
        var options = {
            absentCardEdit: "@Url.Action("AbsentCardEdit")"
        };
    </script>
    @Html.Js("plugins/validator/validator", "plugins/xjdailog/xjdailog", "plugins/form-datepicker/js/bootstrap-datepicker", "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN")
    @Html.Js("app/order/absentcard")
}

