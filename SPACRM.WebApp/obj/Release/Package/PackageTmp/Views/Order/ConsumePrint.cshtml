@{
    ViewBag.Title = "打印小票";
    Layout = "~/Views/Shared/_LayoutD.cshtml";
}
@using SPACRM.Entity.Entities;
@section htmlhead{
    <link href="~/assets/css/plugin/AdminStyle.css" rel="stylesheet" />
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .col-sm-8 {
            padding: 0;
        }

        #td1 {
            border-bottom: 1px solid black;
        }
    </style>
}
<!DOCTYPE html>
<html>
<head>
    <title>消费明细单</title>
</head>
<body style="text-align: left" onload=" window.print()">
    <div style="text-align: left">
        @*<table  border="0" width="182" >
           <tr>
               <td>
                   <input id="btnPrint" class="Noprint" onclick="window.print();" type="button" value="打印" />
               </td>
           </tr>
       </table>*@
        <table border="0" width="180" id="table4">
            <tr>
                <td align="center">
                    <h3>消费明细单</h3>
                </td>
            </tr>
        </table>
        <table border="0" width="180" id="table6">
            <tr>
                <td>门店名称:@ViewBag.head.STORE_NAME
                </td>
            </tr>
            <tr>
                <td>消费日期:@DateTime.Now.ToString("yyyy-MM-dd")
                </td>
            </tr>
            <tr>
                <td>会员卡号:@ViewBag.custinfo.CARD_NO
                </td>
            </tr>
            <tr>
                <td>会员姓名:@ViewBag.custinfo.NAME
                </td>
            </tr>
            <tr>
                <td balance="@ViewBag.head.BALANCE">会员卡级:@ViewBag.head.CARD_NAME
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
        </table>
        @{
            var proItemList = (List<ORDER_DETAIL_EX>)ViewBag.proItemList;
            var lcItemList = (Dictionary<int, CUST_CDETAIL_EX>)ViewBag.lcItemList;
        }
        @if (proItemList != null && proItemList.Count > 0)
        {
            <table border="0" width="180" id="table1">
                <tr>
                    <th>名称
                    </th>
                    <th>单价
                    </th>
                    <th>金额
                    </th>
                    <th>技师
                    </th>
                </tr>
                <tr>
                    <td colspan="4">
                        <hr size="0">
                    </td>
                </tr>
                @foreach (var item in proItemList)
                {
                    <tr>
                        <td colspan="4">@item.PROD_NAME
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">@Convert.ToInt32(item.PROD_PRICE)
                        </td>
                        <td align="center">@Convert.ToInt32(item.PAY_AMT)
                        </td>
                        <td align="center">@item.EMPLOYEE_NAME
                        </td>
                    </tr>	
                }
            </table>
        }

        @if (lcItemList != null && lcItemList.Count > 0)
        {
            <table border="0" width="180" id="table1">

                <tr>
                    <td colspan="4" style="font-weight: bold">疗程明细:
                    </td>
                </tr>
                <tr>
                    <th style="width: 36%">名称
                    </th>
                    <th style="width: 20%">数量
                    </th>
                    <th style="width: 22%">单价
                    </th>
                    <th style="width: 22%">金额
                    </th>
                </tr>
                <tr>
                    <td colspan="4">
                        <hr size="0">
                    </td>
                </tr>
                @foreach (var item in lcItemList)
                {
                    <tr>
                        <td width="56%" colspan="2">@item.Value.SERVICE_NAME
                        </td>
                        <td width="44%" align="center" colspan="2">剩余 @item.Value.AVA_QTY
                        </td>
                    </tr>
                    <tr>
                        <td width="36%" align="right">
                        </td>
                        <td width="20%" align="center" >@item.Value.USED_QTY
                        </td>
                        <td width="22%" align="center" >0
                        </td>
                        <td width="22%" align="center" >
                        </td>
                    </tr>
                 
                }
            </table>
        }
        <table border="0" width="180" id="table10">
            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
            <tr>
                <td width="68%">总计:
                </td>
                <td align="left" width="32%">@ViewBag.head.PAYED_AMT
                </td>
            </tr>
            <tr>
                <td width="68%" colspan="2" style="font-weight: bold">付款明细:
                </td>
            </tr>
            @foreach (var item in (Dictionary<int, decimal>)ViewBag.payments)
            {
                var type = "";
                var _typeValue = item.Key;
                <tr>
                    @if (_typeValue == 0)
                    {
                        type = "现金";
                    }
                    else if (_typeValue == 1)
                    {
                        type = "银联POS";
                    }
                    else if (_typeValue == 2)
                    {
                        type = "应收帐款";
                    }
                    else if (_typeValue == 3)
                    {
                        type = "代金券";
                    }
                    else if (_typeValue == 5)
                    {
                        type = "会员卡";
                    }
                    else if (_typeValue == 6)
                    {
                        type = "电子券";
                    }
                    else if (_typeValue == 999)
                    {
                        type = "疗程支付";
                    }
                    else
                    {
                        type = "多种方式";
                    }
                    <td width="68%">@type
                    </td>
                    <td align="left" width="32%">@item.Value
                    </td>
                </tr>
            }

            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
            <tr>
                <td width="68%">会员卡余额
                </td>
                <td align="left" width="32%">@ViewBag.head.BALANCE
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
        </table>
        <table border="0" width="180">
            <tr>
                <td style="width: 55px;">备注:
                </td>
                <td style="text-align: left;">@ViewBag.head.REMARK
                </td>
            </tr>
            <tr>
                <td>收银员:
                </td>
                <td>@ViewBag.head.SYY
                </td>
            </tr>
            <tr>
                <td>预约电话:
                </td>
                <td>@ViewBag.head.TELEPHONE
                </td>
            </tr>
            <tr>
                <td>门店地址:
                </td>
                <td>@ViewBag.head.ADDRESS
                </td>
            </tr>
            <tr>
                <td style="width: 10px;">打印时间:
                </td>
                <td style="text-align: left;">@DateTime.Now.ToString("yyyy-MM-dd HH:mm")
                </td>
            </tr>
            <tr>
                <td>客户签名:
                </td>
                <td></td>
            </tr>
            <tr>
                <td>&nbsp;
                </td>
            </tr>
            <tr>
                <td>&nbsp;
                </td>
            </tr>
            <tr>
                <td>&nbsp;
                </td>
            </tr>
            <tr>
                <td>&nbsp;
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
@section jssection{
    <script type="text/javascript" language="JavaScript">
        var HKEY_Root, HKEY_Path, HKEY_Key;
        HKEY_Root = "HKEY_CURRENT_USER";
        HKEY_Path = "\\Software\\Microsoft\\Internet Explorer\\PageSetup\\";
        //设置网页打印的页眉页脚为空
        function PageSetup_Null() {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "margin_left"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0.2");  //键值设定--左边边界

            HKEY_Key = "margin_top"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--上边边界

            HKEY_Key = "margin_right"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--右边边界

            HKEY_Key = "margin_bottom"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--下边边界
        }
        PageSetup_Null();
        function WindowPrint() {
            /// 隐藏不需要打印的内容
            try {
                PageSetup_Null();
            }
            catch (e) {
                var errorMsg = e.message + "\r" + "请设置:IE选项->安全->Internet->" + "ActiveX控件和插件" + "\r" + "对未标记为可安全执行脚本的ActiveX的控件初始化并执行脚本->允许/提示";
                //alert(errorMsg);
                return;
            }
            window.print();
        }
    </script>
    <script type="text/javascript">
        var util = {};
        var options = {

        };
    </script>
}
