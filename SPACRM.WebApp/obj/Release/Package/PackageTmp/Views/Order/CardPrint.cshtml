@{
    ViewBag.Title = "打印小票";
    Layout = "~/Views/Shared/_LayoutD.cshtml";
}
@using SPACRM.Entity.Entities;
@section htmlhead{  
    @* @page { margin: 0; }*@

  
    <style type="text/css">
     
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .col-sm-8 {
            padding: 0;
        }

        #td1 {
            border-bottom: 1px solid black;
        }
    </style>
    <style media="print"> .Noprint{display:none;}
		.PageNext{page-break-after: always;}
	</style>
}
<!DOCTYPE html>
<html>

<head>

    <title>sss</title>
</head>
<body style="text-align: left" onload=" window.print();">
    <object id=printFactory style="display:none"
classid="clsid:1663ed61-23eb-11d2-b92f-008048fdd814"  codebase="ScriptX.cab#Version=5,0,4,185">
</object>
    <div style="text-align: left">
 <table  border="0" width="180" >
           <tr>
               <td>
                   <input id="btnPrint" class="Noprint" onclick=" window.print();" type="button" value="打印" />
               </td>
           </tr>
       </table>
        <table border="0" width="180" id="table6">
            <tr>
                <td align="center">
                    <h3>卡销售单</h3>
                </td>
            </tr>
            <tr>
                <td align="left"><font face="Garamond" size="2">门店名称:@ViewBag.head.STORE_NAME </font></td>
            </tr>
            <tr>
                <td align="left"><font face="Garamond" size="2">开卡日期:@DateTime.Now.ToString("yyyy-MM-dd")</font></td>
            </tr>
            <tr>
                <td align="left"><font face="Garamond" size="2">会员卡号:@ViewBag.head.CUST_NO</font></td>
            </tr>
                <tr>
                <td align="left"><font face="Garamond" size="2">会员姓名:@ViewBag.custinfo.NAME</font></td>
            </tr>
            <tr>
                <td align="left" height="1" color="00cccc" id="td1"></td>
            </tr>
        </table>



        <table border="0" width="180" id="table1">
             <tr>
                <th width="100%" colspan="4" ><font face="Garamond" size="2">名称</th>
               
            </tr>
            <tr>
                
                <th  align="left"><font face="Garamond" size="2">标准价</th>
                <th ><font face="Garamond" size="2">金额</th>
                 <th ><font face="Garamond" size="2">销售员</th>
                <th ><font face="Garamond" size="2">备注</th>
            </tr>
            @*<tr>
               
            </tr>*@
            <tr>
                <td colspan="4">
                    <hr size="0">
                </td>
            </tr>
            @foreach (var item in (List<ORDER_DETAIL_EX>)ViewBag.proItemList)
            {
                <tr>
                    <td width="100%" colspan="4" ><font face="Garamond" size="2">@item.PROD_NAME</font></td>
                    </tr>
                 
                <tr>
                    <td  ><font face="Garamond" size="2">@Convert.ToInt32(item.PROD_PRICE)</font></td>
                    <td ><font face="Garamond" size="2">@Convert.ToInt32(item.PAY_AMT)</font></td>
                     <td ><font face="Garamond" size="2">@item.EMPLOYEE_NAME</font></td>
                    <td ><font face="Garamond" size="2">@(item.CARD_TYPE == 2 ? "疗程卡" : "")</font></td>
                </tr>@*
                <tr>
                   
                </tr>*@	                      
            }
           
        </table>




        @foreach (var item in (List<ORDER_DETAIL_EX>)ViewBag.proItemList)
        {
            if (item.CARD_TYPE == 2)
            {  
           
            <table border="0" width="180" id="table1">
           <tr>
                <td align="left" width="50%" colspan="2" style="font-weight: bold"><font face="Garamond" size="2">疗程明细</td>

            </tr>
                <tr>
                    <th style="width: 60%"><font face="Garamond" size="2">名称</th>
                    <th style="width: 20%" align="right"><font face="Garamond" size="2">次数</th>
                   @* <th style="width: 20%">金额</th>*@
                </tr>

                @foreach (var detail in (List<PROD_CDETAIL_EX>)ViewBag.cdetaillist)
                {
                    <tr>
                        <td width="45%"><font face="Garamond" size="2">@detail.SERVICE_NAME</font></td>
                        <td width="25%"  align="right"><font face="Garamond" size="2">@detail.SERVICE_QTY</font></td>
                       @* <td width="30%"><font face="Times New Roman">@detail.AMT_PRICE</font></td>*@
                    </tr>
                                 
                }

            </table>
            }
        }


          @if (ViewBag.custdetail != null && ((List<CUST_CDETAIL_EX>)ViewBag.custdetail).Count > 0)
          {
              if (ViewBag.custdetail[0].TYPE==2)
              {
               <table border="0" width="180" id="table4">
                <tr>
                    <td align="left">
                        <h3>赠送项目</h3>
                    </td>
                </tr>
            </table>
          }
              foreach (var item in (List<CUST_CDETAIL_EX>)ViewBag.custdetail)
              {
                  if (item.TYPE == 2)
                  {
           
            <table border="0" width="180" id="table1">

                <tr>
                    <th style="width: 60%"><font face="Garamond" size="2">名称</th>
                    <th style="width: 20%"><font face="Garamond" size="2">次数</th>
                 
                </tr>

              
                    <tr>
                        <td width="45%"><font face="Garamond" size="2">@item.SERVICE_NAME</font></td>
                        <td width="25%"><font face="Garamond" size="2">@item.SERVICE_QTY</font></td>
                      
                    </tr>
                                 
              

            </table>
                  }
              }
          }


        <table border="0" width="180" id="table10">
            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
            <tr>
                <td align="left" width="50%"><font face="Garamond" size="2">总计:</td>
                <td align="right" width="50%"><font face="Garamond" size="2">@ViewBag.head.PAYED_AMT</font></td>
            </tr>
            <tr>
                <td align="left" width="50%" colspan="2" style="font-weight: bold"><font face="Garamond" size="2">付款明细:</td>

            </tr>

            @foreach (var item in (List<ORDER_PAYMENT_EX>)ViewBag.payments)
            {
                var type = "";
                <tr>

                    @if (item.PAYMENT_TYPE == 0)
                    {
                        type = "现金";
                    }
                    else if (item.PAYMENT_TYPE == 1)
                    {
                        type = "银联POS";
                    }
                    else if (item.PAYMENT_TYPE == 2)
                    {
                        type = "应收帐款";
                    }
                    else if (item.PAYMENT_TYPE == 3)
                    {
                        type = "代金券";
                    }
                    else if (item.PAYMENT_TYPE == 5)
                    {
                        type = "会员卡";
                    }
                    else if (item.PAYMENT_TYPE == 6)
                    {
                        type = "电子券";
                    }

                    else if (item.PAYMENT_TYPE == 999)
                    {
                        type = "疗程支付";
                    }
                    else
                    {
                        type = "多种方式";
                    }
                    <td align="left" width="50%"><font face="Garamond" size="2">@type:</font></td>
                    <td align="right" width="50%"><font face="Garamond" size="2">@item.PAY_AMT</font></td>
                </tr>
            }

            <tr>
                <td align="left" width="20%"><font face="Garamond" size="2">欠款</font></td>
                @{  var LeftPay = ViewBag.head.PAY_AMT - ViewBag.head.PAYED_AMT;
                    <td align="right" width="80%"><font face="Garamond" size="2">@ViewBag.head.ARREARS</font></td>
                }
            </tr>
              <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
              <tr>
                <td align="left" width="20%"><font face="Garamond" size="2">会员卡余额</font></td>
            
                    <td align="right" width="80%"><font face="Garamond" size="2">@ViewBag.head.BALANCE</font></td>
             
            </tr>
            <tr>
                <td colspan="2">
                    <hr size="0">
                </td>
            </tr>
        </table>

        <table border="0">

            <tr>
                <td style="width: 70px;"><font face="Garamond" size="2">备注:</td>
                <td style="text-align: left;"><font face="Garamond" size="2">@ViewBag.head.REMARK</td>
            </tr>

            <tr>
                <td><font face="Garamond" size="2">收银员:</font></td>
                <td><font face="Garamond" size="2">@ViewBag.head.SYY</font></td>
            </tr>
             <tr>
                <td><font face="Garamond" size="2">预约电话:</font></td>
                <td><font face="Garamond" size="2">@ViewBag.head.TELEPHONE</font></td>
            </tr>  <tr>
                <td><font face="Garamond" size="2">门店地址:</font></td>
                <td><font face="Garamond" size="2">@ViewBag.head.ADDRESS</font></td>
            </tr>
            <tr>
                <td style="width: 10px;"><font face="Garamond" size="2">打印时间:</font></td>
                <td style="text-align: left;"><font face="Garamond" size="2">@DateTime.Now.ToString("yyyy-MM-dd HH:mm")</td>
            </tr>

            <tr>
                <td align="left"><font face="Garamond" size="2">客户签名:</font></td>
                <td align="left"><font face="Garamond" size="2"></font></td>
            </tr>

            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td></td>
            </tr>

        @*    <tr>
                <td colspan="2" align="center"><font face="Times New Roman">扑满技术支持:021-62595122</font></td>

            </tr>*@
        </table>

    </div>
</body>

</html>

@section jssection{

    <script type="text/javascript" language="JavaScript">
       
        var HKEY_Root, HKEY_Path, HKEY_Key;
        HKEY_Root = "HKEY_CURRENT_USER";
        HKEY_Path = "\\Software\\Microsoft\\Internet Explorer\\PageSetup\\";
        //设置网页打印的页眉页脚为空
        function PageSetup_Null() {
            var Wsh = new ActiveXObject("WScript.Shell");
            HKEY_Key = "header";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "footer";
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "");
            HKEY_Key = "margin_left"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0.2");  //键值设定--左边边界

            HKEY_Key = "margin_top"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--上边边界

            HKEY_Key = "margin_right"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--右边边界

            HKEY_Key = "margin_bottom"
            Wsh.RegWrite(HKEY_Root + HKEY_Path + HKEY_Key, "0"); //键值设定--下边边界
        }

        PageSetup_Null();
        function WindowPrint() {
            /// 隐藏不需要打印的内容
            try {
                PageSetup_Null();
            }
            catch (e) {
                var errorMsg = e.message + "\r" + "请设置:IE选项->安全->Internet->" + "ActiveX控件和插件" + "\r" + "对未标记为可安全执行脚本的ActiveX的控件初始化并执行脚本->允许/提示";
                //alert(errorMsg);
                return;
            }
            window.print();
        }
    </script>

    <script type="text/javascript">
        var util = {};
        var options = {

        };
    </script>
    @*    @Html.Js("app/customer/edit")*@
}