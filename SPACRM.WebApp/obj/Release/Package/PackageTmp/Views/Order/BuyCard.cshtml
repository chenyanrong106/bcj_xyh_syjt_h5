@{
    ViewBag.Title = "会员卡充值";
}
@model SPACRM.Entity.Entities.CUST_INFO_EX

@section htmlhead{
    @Html.Css("plugin/validator")
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .searchpanel {
            background-color: #f7f8fa; /*border: 1px solid #ccc;*/
            padding: 5px 15px;
            margin-left: 10px;
            border-radius: 4px;
        }

            .searchpanel .form-group label {
                margin-bottom: 4px;
            }

        .panel-body {
            /*height:450px;*/
        }
    </style>

    <style>
        #tCustInfo {
            border: 0px solid #e6e5e5;
            margin-top: 0px;
            line-height: 30px;
        }
    </style>


}
<form action="@Url.Action("BuyCardSave")" id="formSave" method="post" role="form">
    <div class="s_container">
        <div id="page-heading">
            <h2>
                <i class="fa fa-group"></i>购卡/充值</h2>
        </div>

        <div class="row">
            <div class="col-md-3">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>会员信息</h4>
                    </div>
                    <div class="panel-body">
                        <table id="tCustInfo">
                            <tr>
                                <td style="width: 100px;"><b>会员姓名：</b></td>
                                <td>@Model.NAME</td>
                            </tr>
                            <tr>
                                <td><b>联系电话：</b></td>
                                <td>@Model.MOBILE</td>
                            </tr>
                            <tr>
                                <td><b>会员卡号：</b></td>
                                <td>@Model.CARD_NO</td>
                            </tr>
                            <tr>
                                <td><b>会员卡级：</b></td>
                                <td>@Model.CARD_NAME</td>
                            </tr>
                            @*                      <tr>
                          <td><b>开卡日期：</b></td>
                          <td>@Model.BEGIN_DATE</td>
                      </tr>*@
                            @*             <tr>
                          <td><b>有效期：</b></td>
                          <td>@Model.END_DATE</td>
                      </tr>*@
                            <tr>
                                <td><b>总存款额：</b></td>
                                <td>@Model.PAR_AMT</td>
                            </tr>
                            <tr>
                                <td><b>卡内余额：</b></td>
                                <td>@Model.BALANCE</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                @*            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h4>充值存款</h4>

                </div>
                <div class="panel-body" style="display: block;">*@

                <div class="panel panel-primary">
                    <div id="panelService1" class="tab-container tab-gray" style="background-color: white;">
                        <ul class="nav nav-tabs">

                            <li class="active"><a href="#spro" data-toggle="tab">购卡</a></li>
                         @*   <li><a href="#recharge " data-toggle="tab">充值</a></li>*@
                            <li><a href="#service" data-toggle="tab">购买疗程</a></li>
                        </ul>
                        <div style="background-color: white;">
                            <div id="tab-content" class="tab-content">
                                <div class="tab-pane active" id="spro">
                                    <div class="list-group">
                                        <!--begin-->
                                        <div style="height: 400px;">
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="CARD_ID">会员卡级：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.ResourceDropDownList("CARD_ID", "VIPCARD", null, new { @class = "form-control" }, ViewBag.STORE_ID, false)
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="Masseur">销售员：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.ResourceDropDownList("Masseur", "Masseur", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false)
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="BUY_AMT">销售金额：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.TextBox("BUY_AMT", null, new { @class = "form-control", maxlength = "10", placeholder = "请输入销售金额", @readonly = "readonly" })
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="YH_AMT">优惠额：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.TextBox("YH_AMT", null, new { @class = "form-control", maxlength = "6", placeholder = "请输入优惠额", @readonly = "readonly" })
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="BEGIN_DATE">开卡日期：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.TextBox("BEGIN_DATE", DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control", placeholder = "请选择开卡日期" })
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-4 control-label" for="END_DATE">有效期：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.TextBox("END_DATE", DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control", placeholder = "请输入有效期" })
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-8">
                                                <label class="col-sm-3 control-label" for="CASH_AMT">现金支付：</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextBox("CASH_AMT", "", new { @class = "form-control", @readonly = "readonly", placeholder = "支付金额" })
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">

                                                <label class="col-sm-4 control-label" for="PAYCARD_TYPE">卡付：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.ResourceDropDownList("PAYCARD_TYPE", "PAYCARD_TYPE", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false)
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">

                                                <label class="col-sm-6 control-label" for="CARD_CASH_AMT">
                                                    @Html.TextBox("CARD_CASH_AMT", "", new { @class = "form-control", maxlength = "8", placeholder = "支付金额", onkeypress = "util.keyPress(this)", onkeyup = "util.keyUpCash(this)", onblur = "util.onBlur(this)" })

                                                </label>
                                                <div class="col-sm-6 input-group">
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-8">
                                                <label class="col-sm-3 control-label" for="REMARK">备注信息：</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextArea("REMARK", "", new { @class = "form-control", placeholder = "备注信息", style = "resize:none" })

                                                </div>
                                            </div>
                                            <div style="clear: both;"></div>
                                            <div class="form-group btnpanel_right" id="divBtnSave" style="margin-top: 5px;">
                                                <button type="button" id="btnSave" class="btn btn-primary">保存</button>
                                                <button type="button" id="btnReturn" class="btn btn-default">返回</button>
                                            </div>
                                        </div>

                                        <!--end-->

                                    </div>
                                </div>
                               
                                <div class="tab-pane" id="service">
                                    <div id="serGridlist" style="overflow: auto; overflow-x: hidden;">
                                        <!--height:420px;-->
                                        <div class="form-group col-xs-6">
                                            <div class="row">
                                                <label class="col-sm-4 control-label" for="EMAIL">疗程套餐：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.ResourceDropDownList("LCCARD_PACK", "LCCARD_PACK", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false)
                                                </div>
                                            </div>
                                            <div class="row" style="margin-top: 10px;">
                                                <label class="col-sm-4 control-label" for="Masseur">销售员：</label>
                                                <div class="col-sm-8 input-group">
                                                    @Html.ResourceDropDownList("MasseurLCC", "Masseur", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false)
                                                </div>
                                            </div>
                                        </div>

                                        <div style="height: 400px;">
                                            <table id="tSpeedyPro" class="table table-advance table-hover">
                                                <thead style="background-color: #f7f8fa">
                                                    <tr>
                                                        <td style="width: 40%">项目名称</td>
                                                        <td style="width: 10%">单价</td>
                                                        <td style="width: 10%">次数</td>
                                                        <td style="width: 15%">小计</td>
                                                        <td style="width: 15%">操作</td>
                                                        <td style="width: 5%"></td>
                                                    </tr>

                                                </thead>
                                                <tbody>
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        @* <td colspan="3" style="text-align:right; border:0px">应付总额：￥</td>
                                                 <td><span id="spanTotalAmt">0</span></td>*@
                                                        <td colspan="5" style="text-align: right;">
                                                            <div>应付总额：￥<span id="spanTotalAmt">0</span></div>
                                                            <div>还需支付：￥<span id="spanBalanceAmt">0</span></div>
                                                        </td>
                                                    </tr>
                                                    @* <tr>
                                                 <td colspan="3" style="text-align:right;">还需支付：￥</td>
                                                 <td><span id="spanBalanceAmt">0</span></td>
                                             </tr>*@
                                                </tfoot>

                                            </table>
                                            @*  <div style="float:right">剩余未支付：￥<span id="spanBalanceAmt">0</span></div>*@
                                            <!--支付方式Begin-->
                                            @* <div class="panel-body" style="display: block;">*@
                                            <div id="divPayType" class="tab-container tab-gray">
                                                <ul class="nav nav-tabs">
                                                    <li class="active"><a href="#home1" data-toggle="tab">会员卡</a></li>
                                                    <li><a href="#profile1" data-toggle="tab">现金</a></li>
                                                    <li><a href="#profile2" data-toggle="tab">银联POS</a></li>
                                                    @* <li><a href="#profile3" data-toggle="tab">应收帐款</a></li>*@
                                                    @* <li><a href="#profile4" data-toggle="tab">代金券</a></li>*@

                                                </ul>
                                                <div id="divPayTypeContent" class="tab-content">
                                                    <!--会员卡-->
                                                    <div class="tab-pane active" id="home1">
                                                        <div class="form-group">
                                                            <div style="width: 50%;">
                                                                @Html.ResourceDropDownList("VIPCARD_TYPE", "VIPCARD_TYPE", "类型", new { @class = "form-control" }, Model.ID.ToString(), false)
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div style="width: 50%;">
                                                                卡付金额：
                                                                <input style="width: 200px;" type="text" maxlength="8" id="payedMoneyVIPCARD" onkeypress="util.keyPress(this)" onkeyup="util.keyUpCardPay(this)" onblur="util.onBlur(this)" name="payedMoneyVIPCARD" class="form-control mask" placeholder="请输入卡付金额">
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <button type="button" id="btnVIPCARD" class="btn btn-primary">添加这个付款</button>
                                                        </div>
                                                    </div>
                                                    <!--现金-->
                                                    <div class="tab-pane" id="profile1">
                                                        <div class="form-group">
                                                            <div style="width: 50%;">
                                                                <input style="width: 200px;" type="text" maxlength="8" onkeypress="util.keyPress(this)" onkeyup="util.keyUpCardPay(this)" onblur="util.onBlur(this)" id="payedMoney" name="payedMoney" class="form-control mask" placeholder="请输入金额">
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <button type="button" id="btnCash" class="btn btn-primary">添加这个付款</button>
                                                        </div>

                                                    </div>
                                                    <!--银联POS-->
                                                    <div class="tab-pane" id="profile2">
                                                        <div class="form-group">
                                                            <div style="width: 50%;">
                                                                @Html.ResourceDropDownList("POSTCARD_TYPE", "PAYCARD_TYPE", "类型", new { @class = "form-control" })
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div style="width: 50%;">
                                                                <input type="text" class="form-control" maxlength="8" onkeypress="util.keyPress(this)" onkeyup="util.keyUpCardPay(this)" onblur="util.onBlur(this)" placeholder="请输入支付金额" id="payMoneyPOSTCARD" name="payMoneyPOSTCARD" />
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <button type="button" id="btnPOSTCARD" class="btn btn-primary">添加这个付款</button>
                                                        </div>
                                                    </div>
                                                    <!--应收帐款-->
                                                    @* <div class="tab-pane" id="profile3">
                                <div class="form-group">
                                    <div style="width: 50%;">
                                        @Html.ResourceDropDownList("RECEIVABLES", "RECEIVABLES", "类型", new { @class = "form-control" }, Request.QueryString["cid"], false)
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <div style="width: 50%;">
                                        <input type="text" class="form-control" maxlength="8" onkeypress="util.keyPress(this)" onkeyup="util.keyUpCardPay(this)" onblur="util.onBlur(this)" placeholder="请输入支付金额" id="payYSZK" name="payYSZK" />
                                    </div>

                                </div>
                                <div>
                                        <button type="button" id="btnYSZK" class="btn btn-primary">添加这个付款</button>
                                </div>

                            </div>  *@
                                                    @* <!--代金券-->
                            <div class="tab-pane" id="profile4">
                                <div class="form-group">
                                    <div style="width: 40%; float: left;">
                                        <input type="text" class="form-control" maxlength="30" placeholder="编码" id="txtVOUCHAR_NO" name="VOUCHAR_NO" />

                                    </div>
                                    <div style="float: left;">

                                        <button type="button" id="btnCheckPROM" class="btn btn-primary">校验</button>
                                    </div>
                                </div>
                                <div class="form-group" style="clear: both;">
                                    <div>
                                        校验信息：
                                            <label id="Pro_Voucher"></label>
                                        <input id="Pro_FaceValue" value="0" type="hidden" />
                                        <input id="Pro_No" type="hidden" />
                                        <input id="Pro_Id" type="hidden" />
                                    </div>
                                </div>

                                <div class="form-group">
                                        <button type="button" id="btnPROM" class="btn btn-primary">添加这个付款</button>
                                </div>
                            </div>*@
                                                </div>
                                            </div>

                                            <div id="divPayList">
                                                <table id="tablePayList" style="width: 100%;">
                                                    <thead>
                                                        <tr style="border-bottom: 1px solid #e6e5e5">
                                                            <th style="width: 20%">#付款方式</th>
                                                            <th style="width: 35%">支付类型</th>
                                                            <th style="width: 20%">抵扣金额</th>
                                                            <th style="width: 20%">实付金额</th>
                                                            <th style="width: 10%"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <div class="form-group btnpanel_right" id="divBtnSave1" style="margin-top: 5px;">
                                                <button type="button" id="btnSaveOrder" class="btn btn-primary">结账</button>
                                                <button type="button" id="btnReturnList" class="btn btn-default">返回</button>
                                            </div>
                                            @* </div>*@
                                            <!--支付方式End-->
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>


                    </div>
                </div>

            </div>

        </div>
    </div>

    <input type="hidden" name="ID" value="@Model.CARD_ID" />
    <input type="hidden" id="hideCUST_ID" name="CUST_ID" value="@Model.ID" />
    <input type="hidden" id="hidePROD_NAME" name="CARD_NAME" />
    <input type="hidden" id="hide_Type" name="BuyType" />
    <input type="hidden" id="hideLCCARD_PACK" name="LCCARD_NAME" />
    <input type="hidden" id="hidePayAmt" name="TOTAL_AMT" />

</form>


@section jssection{
    <script type="text/javascript">
        var util = {}; var options = {

            @*   queryGodSerCardUrl: "@Url.Action("QueryGodSerCard", new { type = "service" })",*@

        };
    </script>
    @Html.Js("plugins/validator/validator", "plugins/form-datepicker/js/bootstrap-datepicker", "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN")
    @Html.Js("app/order/buycard")





}

