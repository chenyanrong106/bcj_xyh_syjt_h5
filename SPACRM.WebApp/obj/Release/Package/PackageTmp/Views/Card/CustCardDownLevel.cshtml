@{
    ViewBag.Title = "转卡续清";
}


@model SPACRM.Entity.Entities.CUST_INFO_EX
@using SPACRM.Entity

@section htmlhead{
    @Html.Css("plugin/validator", "plugin/xjgrid", "plugin/xjdailog")
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .searchpanel {
            background-color: #f7f8fa; /*border: 1px solid #ccc;*/
            padding: 5px 15px;
            margin-left: 10px;
            border-radius: 4px;
        }

            .searchpanel .form-group label {
                margin-bottom: 4px;
            }

        .panel-body {
            /*height:450px;*/
        }
    </style>

    <style>
        #tCustInfo {
            border: 0px solid #e6e5e5;
            margin-top: 0px;
            line-height: 30px;
        }

        #divPaymentMode ul {
            list-style: none;
        }

            #divPaymentMode ul li {
                float: left;
                width: 280px;
            }

                #divPaymentMode ul li label {
                    width: 100px;
                    text-align: right;
                }

        #spanPresent {
            cursor: pointer;
        }

        #divLCPaymentMode .ul {
            list-style: none;
        }

            #divLCPaymentMode .ul li {
                float: left;
                width: 280px;
            }

        #divLCPaymentMode ul li label {
            width: 100px;
            text-align: right;
        }
    </style>


}
<form action="@Url.Action("CustCardDownLevelSave")" id="formSave" method="post" role="form">
    <div class="s_container">
        <div id="page-heading">
            <h2>
                <i class="fa fa-group"></i>转卡续清</h2>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>会员信息</h4>
                    </div>
                    <div class="panel-body">
                        <table id="tCustInfo">
                            <tr>
                                <td style="width: 80px;"><b>会员姓名：</b></td>
                                <td>@Model.NAME</td>
                            </tr>
                            <tr>
                                <td><b>联系电话：</b></td>
                                <td>@Model.MOBILE</td>
                            </tr>
                            <tr>
                                <td><b>会员卡号：</b></td>
                                <td>@Model.CARD_NO</td>
                            </tr>
                        </table>

                        <div style="height: 1px; background-color: #e6e5e5;"></div>
                        <br />
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">旧卡级:</label>
                            <div class="col-sm-6 input-group">
                                <input name="OLD_CARD_ID" id="OLD_CARD_ID" type="hidden" value="@ViewBag.OLD_CARD_ID" />
                                <input name="OLD_CARD_NAME" id="OLD_CARD_NAME" type="text" class="form-control" readonly="readonly" value="@ViewBag.OLD_CARD_NAME" />
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">面额:</label>
                            <div class="col-sm-6 input-group">
                                <input name="OLD_CARD_ShowAmt" id="OLD_CARD_ShowAmt" type="text" class="form-control" readonly="readonly" value="@ViewBag.PAR_AMT" />
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">余额:</label>
                            <div class="col-sm-6 input-group">
                                <input name="OLD_CARD_BALANCE" id="OLD_CARD_BALANCE" type="text" class="form-control" readonly="readonly" value="@ViewBag.OLD_CARD_BALANCE" />
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">欠款:</label>
                            <div class="col-sm-6 input-group">
                                <input name="OLD_CARD_ARREARS" id="OLD_CARD_ARREARS" type="text" class="form-control" readonly="readonly" value="@ViewBag.OLD_CARD_ARREARS" />
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">新卡级:</label>
                            <div class="col-sm-6 input-group">
                                @Html.ResourceDropDownList("NEW_CARD_ID", "VIPCARD", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID_ORG_ID, false)
                               @* @if (ViewBag.cardType == 1)
                                {
                                    @Html.ResourceDropDownList("NEW_CARD_ID", "VIPCARD", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false, (double)ViewBag.PAR_AMT, 1)
                                }
                                else
                                {
                                    @Html.ResourceDropDownList("LCCARD_PACK", "VIPCARD", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false, (double)ViewBag.PAR_AMT, 2)
                                }*@
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">面额:</label>
                            <div class="col-sm-6 input-group">
                                <input name="NEW_PAR_AMT" id="NEW_PAR_AMT" type="text" class="form-control" readonly="readonly" />
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="CARD_ID">销售额:</label>
                            <div class="col-sm-6 input-group">
                                <input name="BUY_AMT" id="BUY_AMT" type="text" class="form-control"  readonly="readonly"/>
                            </div>
                        </div>
                        @* <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="YH_AMT">优惠额：</label>
                            <div class="col-sm-6 input-group">
                                @Html.TextBox("YH_AMT", null, new { @class = "form-control", maxlength = "6", placeholder = "请输入优惠额", @readonly = "readonly" })
                            </div>
                        </div>*@
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="END_DATE">有效期：</label>
                            <div class="col-sm-6 input-group">
                                @Html.TextBox("END_DATE", DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control", placeholder = "请输入有效期" })
                            </div>
                        </div>
                        <div class="form-group col-xs-6">
                            <label class="col-sm-2 control-label" for="Need_PAY_AMT">还需支付:</label>
                            <div class="col-sm-6 input-group">
                                @Html.TextBox("Need_PAY_AMT", 0, new { @class = "form-control", @readonly = "true" })
                            </div>
                        </div>
                        <div class="form-group col-xs-6" id="isQuitAmt" hidden="hidden">@*当"还需支付金额"为负数时 此处才可见*@
                            <label class="col-sm-2 control-label" for="YH_AMT">退还差额:</label>
                            <div class="col-sm-6 input-group">
                                <input type="radio" name="QuitCash" id="QuitCash" value="1"><span>退现金</span></input>
                                <input type="radio" name="QuitCash" id="NoQuit" value="2" checked="checked"><span>不退</span></input>
                            </div>
                        </div>
                            <div class="form-group col-xs-12">
                            <b><span id="spanPresent">赠送项目【收起】</span> </b>
                            <div id="divPresent" style="padding: 5px; width: 100%; display: block;">
                                <div class="col-sm-4 input-group">
                                    <select id="Present_Prod" class="form-control" >@*disabled="disabled"*@
                                        <option>请选择...</option>
                                    </select>赠送上限金额￥：<span id="spanPLPRICE" class="badge badge-info">0</span>

                                </div>
                                <div class="form-group col-xs-6">
                                    <table id="tProdItem" style="margin-top: 5px; margin-left: -10px;" class="table table-advance table-hover">
                                        <thead style="background-color: #f7f8fa">
                                            <tr>
                                                <td style="width: 15%">选择</td>
                                                <td style="width: 50%">项目名称</td>
                                                <td style="width: 15%">单价</td>
                                                <td style="width: 20%">次数</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="2" style="text-align: left;">
                                                    <span class="badge badge-info">注：</span>如有欠款系统不赠送项目,续清赠送。
                                                </td>
                                                <td colspan="2" style="text-align: right;">合计￥：<span id="spanTotalPrice" class="badge badge-info">0</span>
                                                </td>
                                            </tr>
                                        </tfoot>

                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-xs-12">
                            <div id="divPayType">
                                <b>支付方式</b>
                                <div style="margin-left: 100px;">还需支付￥：<span id="spanPayed" class="badge badge-info">0</span></div>
                                <div id="divPaymentMode" style="padding: 5px; width: 100%;">
                                    <ul style="float: left;">
                                        @if (ViewBag.paymentList != null)
                                        {
                                            foreach (var item in (List<PAYMENT_MODE>)ViewBag.paymentList)
                                            {
                                            <li class="mode">
                                                <label>@item.NAME:</label>
                                                <input type="hidden" name="PaymentModeId" value="@item.CODE" />
                                                <input type="hidden" name="PaymentModeType" value="@item.TYPE" />
                                                <input name="PaymentMode" maxlength="6" type="text" onkeypress="util.keyPress(this)" onkeyup="util.keyUpPayment(this)" onblur="util.onBlur(this)" />
                                            </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </div>
                            <div id="divPayType2">@* class="tab-container tab-gray"*@
                                <b>支付方式</b>
                                <div style="margin-left: 100px;">还需支付￥：<span id="spanPayed2" class="badge badge-info">0</span></div>
                                <div id="divPaymentMode2" style="padding: 5px; width: 100%;">
                                    <ul style="float: left;">
                                        <li class="mode" id="li_cash_pay" hidden="hidden">
                                            <label>现金：</label>
                                            @*<input type="hidden"  value="" />*@
                                            <input name="PaymentModeCash" maxlength="6" id="cashpay" type="text" readonly="readonly" disabled="disabled"/>
                                        </li>
                                        @* <li class="mode" id="li_card_pay" hidden="hidden">
                                            <label>会员卡：</label>
                                            <input name="PaymentModeCard" maxlength="6" id="cardpay" type="text" readonly="readonly" />
                                        </li>*@
                                    </ul>
                                </div>
                            </div>
                        </div>
                    

                        <div class="form-group btnpanel_right" id="divBtnSave1" style="margin-top: 5px; margin-bottom: 5px;">
                            <button type="button" id="btnSaveOrder" class="btn btn-primary">保存</button>
                            <button type="button" id="btnReturnList" class="btn btn-default">返回</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hideCUST_ID" name="CUST_ID" value="@Model.ID" />
    <input type="hidden" id="hidePROD_NAME" name="CARD_NAME" />
    <input type="hidden" id="CUST_CARD_ID" name="CUST_CARD_ID" value="@ViewBag.Cust_Card_Id" />
    <input type="hidden" id="cardType" name="cardType" value="@ViewBag.cardType"/>
    <input type="hidden" id="CardBeginDate" name="CardBeginDate" />
    <input type="hidden" id="CardEndDate" name="CardEndDate" />
    <input type="hidden" id="hidePROD_NAME" name="CARD_NAME" />
    <input type="hidden" id="PAYED_AMT" name="PAYED_AMT" />
    <input type="hidden" id="hideBeginDate" name="BeginDate" />
    <input type="hidden" id="hideEndDate" name="EndDate" />
    <input type="hidden" id="OLD_CARD_SALES_AMT" name="OLD_CARD_SALES_AMT" value="@ViewBag.OLD_CARD_SALES_AMT"/>
@*    <input type="hidden" id="OLD_CARD_USED_AMT" name="OLD_CARD_USED_AMT" value="@ViewBag.OLD_CARD_USED_AMT"/>*@
</form>


@section jssection{
    <script type="text/javascript">
        var util = {}; var options = {

            @*   queryGodSerCardUrl: "@Url.Action("QueryGodSerCard", new { type = "service" })",*@
            QuerySerlistUrl: "@Url.Action("List", "SERVICE")",
            QueryCardByIDUrl: "@Url.Action("getCardByID", "Order")"
        };
    </script>
    @Html.Js("plugins/validator/validator", "plugins/xjgrid/xjgrid", "plugins/form-datepicker/js/bootstrap-datepicker", "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN")
    @Html.Js("app/card/custcarddownlevel")





}
