@{
    ViewBag.Title = "ChangeCardLevel";
}

@model SPACRM.Entity.CUST_CARD_CHANGE_EX
@using SPACRM.Entity
@section htmlhead{
    @Html.Css("plugin/validator", "plugins/form-select2/select2")
    @Html.Css("plugin/xjgrid", "plugin/xjdailog", "common", "plugin/validator", "plugin/tip")
    <style type="text/css">
        .h_title {
            padding: 5px 15px;
            border-bottom: solid 1px #e6e5e5;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .searchpanel {
            background-color: #f7f8fa; /*border: 1px solid #ccc;*/
            padding: 5px 15px;
            margin-left: 10px;
            border-radius: 4px;
        }

            .searchpanel .form-group label {
                margin-bottom: 4px;
            }

        .panel-body {
            /*height:450px;*/
        }
    </style>

    <style>
        #tCustInfo {
            border: 0px solid #e6e5e5;
            margin-top: 0px;
            line-height: 30px;
        }

        #divPaymentMode ul {
            list-style: none;
        }

            #divPaymentMode ul li {
                float: left;
                width: 280px;
            }

                #divPaymentMode ul li label {
                    width: 100px;
                    text-align: right;
                }

        #spanPresent {
            cursor: pointer;
        }
    </style>

    @*  @Html.Js("plugins/xjgrid/xjgrid", "plugins/xjdailog/xjdailog",
    "plugins/validator/validator", "plugins/form-datepicker/js/bootstrap-datepicker",
    "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN",
   "app/company/jquery.tree", "app/card/changecardlevel")*@
    <link rel='stylesheet' type='text/css' href='../../assets/css/tree.css' />
}


<form action="@Url.Action("ChangeCardLevelSave")" id="frmSave" method="post">
    <div class="s_container">
        <div id="page-heading">
            <h2>
                <i class="fa fa-group"></i>卡级变更</h2>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>会员信息</h4>
                    </div>
                    <div class="panel-body">


                        <div id="divNewCustomer">
                            <div class="form-group col-xs-6">
                                <label class="col-sm-2 control-label">会员姓名:</label>
                                <div class="col-sm-6 input-group">
                                    <input type="hidden" id="CUST_NAME" style="width: 100%" />
                                </div>
                            </div>
                        </div>

                        <div id="divCustomer">
                            <div class="form-group col-xs-6">
                                <label class="col-sm-2 control-label">会员姓名:</label>
                                <div class="col-sm-6 input-group">
                                    @*<label class="control-label">@Model.CUST_NAME</label>*@
                                    <span id="spanCustName"></span>
                                    <input type="hidden" id="CUST_NAME" style="width: 100%" />
                                </div>
                            </div>

                            <div class="form-group col-xs-6">
                                <label class="col-sm-2 control-label">会员卡号:</label>
                                <div class="col-sm-6 input-group">
                                    @*<label class="control-label">@Model.CUST_NO</label>*@
                                    <span id="spanCustCard"></span>
                                </div>
                            </div>
                            <div class="form-group col-xs-6">
                                <label class="col-sm-2 control-label">联系电话:</label>
                                <div class="col-sm-6 input-group">
                                    <span id="spanCustMobile"></span>
                                    @*<label class="control-label">@Model.MOBILE</label>*@
                                </div>

                            </div>
                            @*    <div class="form-group col-xs-6">
                                <label class="col-sm-2 control-label">归属门店:</label>
                                <div class="col-sm-6 input-group">
                                    <input type="hidden" name="OP_STORE_ID" value="@Model.OP_STORE_ID" />
                                    <label class="control-label">@Model.OP_STORE_ID</label>
                                </div>

                            </div>*@

                            @*卡级信息*@
                            <table id="tCardLavel" class="table table-advance table-hover">
                                <thead style="background-color: #f7f8fa">
                                    <tr class='thead'>
                                        <td style="width: 5%;">
                                            <div style="text-align: left;">选择</div>
                                        </td>
                                        <td style="width: 10%;">
                                            <div style="text-align: left;">归属门店</div>
                                        </td>
                                        <td style="width: 25%;">
                                            <div style="text-align: left;">卡级</div>
                                        </td>
                                        <td style="width: 20%;">
                                            <div style="text-align: left;">面额</div>
                                        </td>
                                        <td style="width: 20%;">
                                            <div style="text-align: left;">余额</div>
                                        </td>
                                        <td style="width: 20%;">
                                            <div style="text-align: left;">欠款</div>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.CUST_CARD != null)
                                    {

                                        foreach (var c in Model.CUST_CARD)
                                        {
                                        <tr class='strip'>
                                            <td>
                                                <input type="radio" id="isSelect" /><input type="hidden" name="ID" value="@c.ID" /><input type="hidden" name="STORE_ID" value="@c.STORE_ID" /></td>
                                            <td>@c.STORE_NAME</td>
                                            <td>@c.CARD_NAME</td>
                                            <td>@c.PAR_AMT</td>
                                            <td>@c.BALANCE</td>
                                            <td>@c.ARREARS</td>
                                        </tr>
                                        }
                                    }
                                    else
                                    {
                                        
@*<div class="alert alert-dismissable alert-info">
                                                <strong>提示!</strong> 该顾客没有任何卡级信息。
                                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                                                        &times;</button>
                                            </div>*@
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            @* //right*@
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>卡级变更</h4>
                    </div>
                    <div style="background-color: white;">
                        <div id="tab-content" class="tab-content">
                            <div class="tab-pane active" id="spro">

                                <div id="serGridlist" style="overflow: auto; overflow-x: hidden;">
                                    <div class="list-group">
                                        <!--begin-->
                                        <div style="height: 450px;">
                                            <div class="form-group col-xs-12">&nbsp;</div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="CARD_ID">新卡级:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.ResourceDropDownList("NEW_CARD_ID", "VIPCARD", null, new { @class = "form-control" }, (string)ViewBag.STORE_ID, false)
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="BUY_AMT">销售金额:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextBox("NEW_CARD_SALE_AMT", null, new { @class = "form-control", maxlength = "10", placeholder = "请输入销售金额" })
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="BUY_AMT">卡内充值:</label>
                                                <div class="col-sm-6 input-group">
                                                    <input name="NEW_PAR_AMT" id="NEW_PAR_AMT" type="text" class="form-control" readonly="readonly" />
                                                    @*// @Html.TextBox("NEW_CARD_SALE_AMT", null, new { @class = "form-control", maxlength = "10", placeholder = "请输入销售金额", @readonly = "readonly" })*@
                                                </div>

                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="YH_AMT">卡内余额:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextBox("OLD_CARD_BALANCE", null, new { @class = "form-control", maxlength = "6", @readonly = "readonly" })

                                                   @* <input type="checkbox" name="IsOfUse" id="IsOfUse" value="1" onclick="util.click(this)" /><span>是否用余额</span><input type="text" style="width: 50px;" size="15" name="OfUseAmt" id="OfUseAmt" onchange="util.onChangeAmt(this)" /><span>抵扣</span>*@
                                                </div>
                                            </div>
                                            @*<div class="form-group col-xs-6">
                                                </div>
                                             <div class="form-group col-xs-6">
                                                   <label class="col-sm-2 control-label" for="YH_AMT">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                <div class="col-sm-6 input-group">
                                                   <input type="checkbox" name="IsOfUse" id="IsOfUse" value="1" onclick="util.click(this)" /><span>是否用卡内余额&nbsp;</span><input type="text" style="width: 50px;" size="15" name="OfUseAmt" id="OfUseAmt" onchange="util.onChangeAmt(this)" /><span>&nbsp;抵扣</span>
                                                </div>
                                            </div>*@

                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="BUY_AMT">欠    款:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextBox("OLD_CARD_ARREARS", 0, new { @class = "form-control", @readonly = "true" })
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="BUY_AMT">需支付额:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextBox("Need_PAY_AMT", 0, new { @class = "form-control", @readonly = "true" })
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6" id="isQuitAmt" hidden="hidden">@*当"还需支付金额"为负数时 此处才可见*@
                                                <label class="col-sm-2 control-label" for="YH_AMT">退还差额:</label>
                                                <div class="col-sm-6 input-group">
                                                    <input type="radio" name="QuitCash" id="QuitCash" value="1"><span>退现金</span></input>
                                                    <input type="radio" name="QuitCash" id="NoQuit" value="2" checked="checked" ><span>不退</span></input>
                                                </div>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label class="col-sm-2 control-label" for="REMARK">备注信息:</label>
                                                <div class="col-sm-6 input-group">
                                                    @Html.TextArea("REMARK", "", new { @class = "form-control", placeholder = "备注信息", style = "resize:none" })

                                                </div>
                                            </div>
                                            <div>
                                                <div class="col-md-12" id="isSendProc" hidden="hidden">
                                                    <div class="form-group col-xs-12">
                                                        <b><span id="spanPresent">赠送项目【收起】</span> </b>
                                                        <div id="divPresent" style="padding: 5px; width: 100%; display: block;">
                                                            <div class="col-sm-4 input-group">
                                                                <select id="Present_Prod" class="form-control">
                                                                    <option>请选择...</option>
                                                                </select>赠送上限金额￥：<span id="spanPLPRICE" class="badge badge-info">0</span>

                                                            </div>
                                                            <div class="form-group col-xs-6">
                                                                <table id="tProdItem" style="margin-top: 5px; margin-left: -10px;" class="table table-advance table-hover">
                                                                    <thead style="background-color: #f7f8fa">
                                                                        <tr>
                                                                            <td style="width: 15%">选择</td>
                                                                            <td style="width: 50%">项目名称</td>
                                                                            <td style="width: 15%">单价</td>
                                                                            <td style="width: 20%">次数</td>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    </tbody>
                                                                    <tfoot>
                                                                        <tr>
                                                                            <td colspan="2" style="text-align: left;">
                                                                                <span class="badge badge-info">注：</span>如有欠款系统不赠送项目,续清赠送。
                                                                            </td>
                                                                            <td colspan="2" style="text-align: right;">合计￥：<span id="spanTotalPrice" class="badge badge-info">0</span>
                                                                            </td>
                                                                        </tr>
                                                                    </tfoot>

                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!--支付方式Begin-->
                                                <div class="form-group col-xs-12">
                                                    <div id="divPayType">@*class="tab-container tab-gray"*@
                                                        <b>支付方式</b>
                                                        <div style="margin-left: 100px;">还需支付￥：<span id="spanPayed" class="badge badge-info">0</span></div>
                                                        <div id="divPaymentMode" style="padding: 5px; width: 100%;">
                                                            <ul style="float: left;">

                                                                @if (ViewBag.paymentList != null)
                                                                {
                                                                    foreach (var item in (List<PAYMENT_MODE>)ViewBag.paymentList)
                                                                    {
                                                                    <li class="mode">
                                                                        <label>@item.NAME:</label>
                                                                        <input type="hidden" name="PaymentModeId" value="@item.CODE" />
                                                                        <input type="hidden" name="PaymentModeType" value="@item.TYPE" />
                                                                        <input name="PaymentMode" maxlength="6" type="text" onkeypress="util.keyPress(this)" onkeyup="util.keyUpPayment(this)" onblur="util.onBlur(this)" />
                                                                    </li>
                                                                    }
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>


                                                    <div id="divPayType2">@* class="tab-container tab-gray"*@
                                                        <b>支付方式</b>
                                                        <div style="margin-left: 100px;">还需支付￥：<span id="spanPayed2" class="badge badge-info">0</span></div>
                                                        <div id="divPaymentMode2" style="padding: 5px; width: 100%;">
                                                            <ul style="float: left;">
                                                                <li class="mode" id="li_cash_pay" hidden="hidden">
                                                                    <label>现金：</label>
                                                                    @*<input type="hidden"  value="" />*@
                                                                    <input name="PaymentModeCash" maxlength="6" id="cashpay" type="text" readonly="readonly" />
                                                                </li>
                                                               @* <li class="mode" id="li_card_pay" hidden="hidden">
                                                                    <label>会员卡：</label>
                                                                    <input name="PaymentModeCard" maxlength="6" id="cardpay" type="text" readonly="readonly" />
                                                                </li>*@
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group btnpanel_right" id="divBtnSave1" style="margin-top: 5px;margin-bottom: 5px;">
                                                    <button type="button" id="btnSaveOrder" class="btn btn-primary">保存</button>
                                                    <button type="button" id="btnReLoad" class="btn btn-default">重置</button>
                                                    <button type="button" id="btnReturnList" class="btn btn-default">返回</button>
                                                </div>
                                            </div>
                                            <!--支付方式End-->
                                        </div>
                                    </div>
                                    <!--end-->



                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    @* </div>*@
    <input type="hidden" name="OP_STORE_ID" value="@Model.OP_STORE_ID" />
    <input type="hidden" name="ID" value="@Model.ID" />
    <input type="hidden" id="hide_Cid" name="hide_Cid" value="@Model.CUST_ID" />
    <input type="hidden" id="hideCUST_ID" name="CUST_ID" value="@Model.CUST_ID" />
    <input type="hidden" id="hidePROD_NAME" name="CARD_NAME" value="@Model.NEW_CARD_NAME" />
    <input type="hidden" id="hide_Type" name="BuyType" />
    <input type="hidden" id="hideLCCARD_PACK" name="LCCARD_NAME" />
    <input type="hidden" id="hidePayAmt" name="TOTAL_AMT" />
    <input type="hidden" id="hideBeginDate" name="BeginDate" />
    <input type="hidden" id="hideEndDate" name="EndDate" />
    <input type="hidden" id="hideCard_Id" name="CARD_ID" value="@Request.QueryString["ccid"]" />

    <input type="hidden" name="OLD_CARD_ID" id="OLD_CARD_ID" value="@Model.OLD_CARD_ID" />
    <input type="hidden" name="OLD_CARD_TAMT" id="OLD_CARD_TAMT" />
    <input type="hidden" name="OLD_CARD_PAYED" id="OLD_CARD_PAYED" />
    @*  <input type="hidden" name="OLD_CARD_ARREARS" id="OLD_CARD_ARREARS" />*@
    <input type="hidden" id="IsSelectOldCardLevel" />
    <input type="hidden" id="PAYED_AMT" name="PAYED_AMT" />
    <input type="hidden" id="CUST_CARD_ID" name="CUST_CARD_ID" />
    <input type="hidden" id="NEW_CARD_BALANCE" name="NEW_CARD_BALANCE" />@*卡内充值*@
    <input type="hidden" id="CardBeginDate" name="CardBeginDate" />
    <input type="hidden" id="CardEndDate" name="CardEndDate" />
    <input type="hidden" id="IsOfUseValue" name="IsOfUseValue" />


</form>


<link rel='stylesheet' type='text/css' href='~/assets/plugins/form-select2/select2.css' />
@section jssection{
    <script type="text/javascript">
        var util = {};
        var options = {
            queryCustomerUrl: "@Url.Action("QueryCustomer", "Customer", new { type = "name" })",
            listUrl: "@Url.Action("ChangeCardLevelList")",
            queryRightUrl: "@Url.Action("QueryRight")",
            editUrl: "@Url.Action("EditCustExpandInfo")",
            deleteUrl: "@Url.Action("DeleteCustExpandInfo")",
            queryOrder: "@Url.Action("QueryCustExpandLevelOrder")",

        };


    </script>

    @Html.Js("plugins/validator/validator", "plugins/xjgrid/xjgrid",
 "plugins/xjdailog/xjdailog", "plugins/form-datepicker/js/bootstrap-datepicker",
 "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN",
 "js/common", "app/card/changecardlevel")

    @Html.Js("plugins/form-typeahead/typeahead.min", "plugins/form-select2/select2")
    @Html.Js("plugins/validator/validator", "plugins/xjgrid/xjgrid", "plugins/form-datepicker/js/bootstrap-datepicker", "plugins/form-datepicker/js/locales/bootstrap-datepicker.zh-CN")


}
